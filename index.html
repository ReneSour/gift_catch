<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Atrapa los regalos correctos</title>
    <style>
        :root {
            --bg-color-top: #001f3f;
            --bg-color-bottom: #003366;
            --text-color: #ffffff;
            --accent-color: #ffcc00;
            --danger-color: #ff4136;
            --success-color: #2ecc40;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #000;
            font-family: var(--font-family);
            color: var(--text-color);
            position: relative;
        }

        /* Background Elements */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: twinkle infinite alternate;
        }

        @keyframes twinkle {
            from {
                opacity: 0.3;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        .snow {
            position: absolute;
            top: -10px;
            color: white;
            font-size: 10px;
            animation: fall linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes fall {
            to {
                transform: translateY(110vh);
            }
        }

        /* Game Area */
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 600px;
            margin: 0 auto;
            overflow: hidden;
            z-index: 10;
            border-left: 5px solid #fff;
            border-right: 5px solid #fff;
            border-image: repeating-linear-gradient(45deg, #ff0000, #ff0000 10px, #ffffff 10px, #ffffff 20px) 1;

            /* New Background Image */
            background-image: url('images/papa_noel.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* Darken overlay for better visibility */
        #game-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            /* Semi-transparent dark overlay */
            z-index: 0;
        }

        #player {
            position: absolute;
            bottom: 20px;
            width: 80px;
            height: 80px;
            z-index: 20;
            transition: transform 0.1s;
            font-size: 70px;
            text-align: center;
            line-height: 80px;
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        }

        .item {
            position: absolute;
            width: 60px;
            /* Slightly larger for images */
            height: 60px;
            z-index: 15;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.5));
        }

        /* UI Layers */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            padding: 40px;
            text-align: center;
            backdrop-filter: blur(5px);

            /* Festive Pine Garland Border */
            border: 25px solid transparent;
            border-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3C!-- Pine Background --%3E%3Crect width='60' height='60' fill='none'/%3E%3C!-- Pine Branches --%3E%3Cpath d='M0 30 Q15 10 30 30 Q45 50 60 30' stroke='%23228B22' stroke-width='15' fill='none' stroke-linecap='round'/%3E%3Cpath d='M0 30 Q15 50 30 30 Q45 10 60 30' stroke='%23006400' stroke-width='10' fill='none' stroke-linecap='round'/%3E%3C!-- Ornaments --%3E%3Ccircle cx='15' cy='20' r='5' fill='%23FF0000'/%3E%3Ccircle cx='45' cy='40' r='5' fill='%23FFD700'/%3E%3Ccircle cx='30' cy='30' r='4' fill='%23FF0000'/%3E%3C/svg%3E") 25 round;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
        }

        .hidden {
            display: none !important;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: #ff0000;
            text-shadow: 2px 2px 0 #fff, -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
            font-family: 'Georgia', serif;
            letter-spacing: 1px;
        }

        h2 {
            font-size: 1.5rem;
            margin: 10px 0;
        }

        p {
            font-size: 1.1rem;
            line-height: 1.5;
            margin: 10px 0;
        }

        .instructions-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 15px;
            text-align: left;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #2ecc40;
        }

        .icon-sample {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            flex-wrap: wrap;
        }

        .icon-sample img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .btn {
            background: linear-gradient(to bottom, #ff0000, #cc0000);
            border: 2px solid #fff;
            border-radius: 50px;
            padding: 15px 40px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 10px rgba(255, 0, 0, 0.3);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid white;
            margin-top: 10px;
            box-shadow: none;
        }

        /* HUD */
        #hud {
            position: absolute;
            top: 10px;
            left: 0;
            width: 100%;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 50;
            text-shadow: 2px 2px 2px #000;
            color: #ffcc00;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.8rem;
            }

            .instructions-grid {
                padding: 15px;
                gap: 10px;
            }

            p {
                font-size: 1rem;
            }
        }
    </style>
</head>

<body>

    <!-- Background Effects -->
    <div id="stars-container"></div>

    <!-- Game Container -->
    <div id="game-container">
        <div id="player">ðŸŽ…</div>
        <div id="items-container"></div>

        <!-- HUD -->
        <div id="hud" class="hidden">
            <div id="score-display">Puntaje: 0</div>
            <div id="best-score-display">RÃ©cord: 0</div>
        </div>

        <!-- Start Screen -->
        <div id="start-screen" class="overlay">
            <h1>ðŸŽ„ Atrapa los regalos ðŸŽ„</h1>
            <div class="instructions-grid">
                <div class="icon-sample">
                    <img src="images/coca_cola.png" alt="Coca Cola">
                    <img src="images/pavo.png" alt="Pavo">
                    <img src="images/inca_kola.png" alt="Inca Kola">
                </div>
                <div>
                    <strong>Regalos CORRECTOS</strong><br>
                    <span style="color: #2ecc40;">Â¡AtrÃ¡palos!</span> (Coca-Cola, Pavito, Inca Kola)
                </div>
                <div class="icon-sample">
                    <img src="images/grinch.png" alt="Grinch">
                    <img src="images/kola_real.png" alt="KR">
                    <img src="images/pepsi.png" alt="Pepsi">
                </div>
                <div>
                    <strong>Regalos INCORRECTOS</strong><br>
                    <span style="color: #ff4136;">Â¡EvÃ­talos!</span> (Grinch, KR, Pepsi)
                </div>
            </div>
            <p>Ayuda a Santa a recolectar la cena navideÃ±a.</p>
            <button class="btn" id="start-btn">ðŸŽ… Comenzar</button>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="overlay hidden">
            <h1>ðŸŽ… Fin del juego ðŸŽ…</h1>
            <p id="final-score">Puntaje obtenido: 0</p>
            <p id="final-best-score">RÃ©cord personal: 0</p>
            <p style="color: #ffcc00; font-size: 0.9rem; margin-top: 20px;">
                ðŸ“¸ Â¡Toma un screenshot y comparte tu espÃ­ritu navideÃ±o!
            </p>
            <button class="btn" id="retry-btn">Reintentar</button>
            <button class="btn btn-secondary" id="home-btn">Volver al inicio</button>
        </div>
    </div>

    <script>
        /**
         * Game Logic
         */
        const Game = {
            state: 'start', // start, playing, gameover
            score: 0,
            bestScore: 0,
            width: 0,
            height: 0,
            playerX: 0,
            playerSpeed: 0,
            basePlayerSpeed: 7, // Desktop speed
            mobilePlayerSpeed: 6, // Mobile speed
            items: [],
            lastTime: 0,
            spawnTimer: 0,
            spawnInterval: 1500, // Initial spawn interval ms
            difficultyTimer: 0,
            speedMultiplier: 1,

            // Configuration
            playerWidth: 80,
            playerHeight: 80,
            itemSize: 60,

            // DOM Elements
            container: document.getElementById('game-container'),
            player: document.getElementById('player'),
            itemsContainer: document.getElementById('items-container'),
            scoreEl: document.getElementById('score-display'),
            bestScoreEl: document.getElementById('best-score-display'),
            startScreen: document.getElementById('start-screen'),
            gameOverScreen: document.getElementById('game-over-screen'),
            finalScoreEl: document.getElementById('final-score'),
            finalBestScoreEl: document.getElementById('final-best-score'),

            // Input State
            keys: { ArrowLeft: false, ArrowRight: false },
            touchInput: 0, // -1 left, 0 none, 1 right

            init() {
                this.resize();
                window.addEventListener('resize', () => this.resize());

                // Load Best Score
                const savedScore = localStorage.getItem('christmasCatchBestScore');
                if (savedScore) this.bestScore = parseInt(savedScore, 10);
                this.updateHUD();

                // Inputs
                this.setupInputs();

                // Background Effects
                this.createStars();
                this.createSnow();

                // Buttons
                document.getElementById('start-btn').addEventListener('click', () => this.startGame());
                document.getElementById('retry-btn').addEventListener('click', () => this.startGame());
                document.getElementById('home-btn').addEventListener('click', () => this.showHome());
            },

            resize() {
                const rect = this.container.getBoundingClientRect();
                this.width = rect.width;
                this.height = rect.height;
                // Keep player in bounds if resized
                if (this.playerX > this.width - this.playerWidth) {
                    this.playerX = this.width - this.playerWidth;
                    this.updatePlayerPos();
                }
            },

            setupInputs() {
                // Keyboard
                window.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') this.keys.ArrowLeft = true;
                    if (e.key === 'ArrowRight') this.keys.ArrowRight = true;
                });
                window.addEventListener('keyup', (e) => {
                    if (e.key === 'ArrowLeft') this.keys.ArrowLeft = false;
                    if (e.key === 'ArrowRight') this.keys.ArrowRight = false;
                });

                // Touch
                const handleTouch = (e) => {
                    e.preventDefault(); // Prevent scrolling
                    const touch = e.touches[0];
                    if (!touch) {
                        this.touchInput = 0;
                        return;
                    }
                    const rect = this.container.getBoundingClientRect();
                    const touchX = touch.clientX - rect.left;

                    if (touchX < this.width / 2) {
                        this.touchInput = -1;
                    } else {
                        this.touchInput = 1;
                    }
                };

                this.container.addEventListener('touchstart', handleTouch, { passive: false });
                this.container.addEventListener('touchmove', handleTouch, { passive: false });
                this.container.addEventListener('touchend', () => { this.touchInput = 0; });
            },

            createStars() {
                const starsContainer = document.getElementById('stars-container');
                for (let i = 0; i < 50; i++) {
                    const star = document.createElement('div');
                    star.classList.add('star');
                    star.style.left = Math.random() * 100 + 'vw';
                    star.style.top = Math.random() * 100 + 'vh';
                    const size = Math.random() * 3 + 1;
                    star.style.width = size + 'px';
                    star.style.height = size + 'px';
                    star.style.animationDuration = (Math.random() * 2 + 1) + 's';
                    star.style.animationDelay = Math.random() * 2 + 's';
                    starsContainer.appendChild(star);
                }
            },

            createSnow() {
                // Simple snow effect using multiple elements
                const count = 20;
                for (let i = 0; i < count; i++) {
                    const flake = document.createElement('div');
                    flake.className = 'snow';
                    flake.textContent = 'â„';
                    flake.style.left = Math.random() * 100 + 'vw';
                    flake.style.opacity = Math.random();
                    flake.style.fontSize = (Math.random() * 10 + 10) + 'px';
                    flake.style.animationDuration = (Math.random() * 5 + 5) + 's';
                    flake.style.animationDelay = (Math.random() * 5) + 's';
                    document.body.appendChild(flake);
                }
            },

            showHome() {
                this.state = 'start';
                this.startScreen.classList.remove('hidden');
                this.gameOverScreen.classList.add('hidden');
                document.getElementById('hud').classList.add('hidden');
                this.clearItems();
            },

            startGame() {
                this.state = 'playing';
                this.score = 0;
                this.speedMultiplier = 1;
                this.spawnInterval = 1200;
                this.spawnTimer = 0;
                this.difficultyTimer = 0;
                this.items = [];
                this.clearItems();

                this.playerX = (this.width - this.playerWidth) / 2;
                this.updatePlayerPos();

                this.startScreen.classList.add('hidden');
                this.gameOverScreen.classList.add('hidden');
                document.getElementById('hud').classList.remove('hidden');
                this.updateHUD();

                this.lastTime = performance.now();
                requestAnimationFrame((t) => this.loop(t));
            },

            clearItems() {
                this.itemsContainer.innerHTML = '';
            },

            spawnItem() {
                const typeRoll = Math.random();
                // 40% chance of correct gift, 60% bad
                const isCorrect = typeRoll > 0.6;

                let imageUrl;
                if (isCorrect) {
                    // Correct: Coke, Turkey, Inca Kola
                    const correctItems = ['images/coca_cola.png', 'images/pavo.png', 'images/inca_kola.png'];
                    imageUrl = correctItems[Math.floor(Math.random() * correctItems.length)];
                } else {
                    // Incorrect: Grinch, Kola Real, Pepsi
                    const badItems = ['images/grinch.png', 'images/kola_real.png', 'images/pepsi.png'];
                    imageUrl = badItems[Math.floor(Math.random() * badItems.length)];
                }

                const el = document.createElement('div');
                el.classList.add('item');
                el.style.backgroundImage = `url('${imageUrl}')`;

                // Random X position
                const maxX = this.width - this.itemSize;
                const x = Math.random() * maxX;
                const y = -this.itemSize;

                // Speed varies slightly
                const baseSpeed = 200 * this.speedMultiplier; // pixels per second
                const speed = baseSpeed + Math.random() * 50;

                const item = {
                    el,
                    x,
                    y,
                    speed,
                    isCorrect,
                    width: this.itemSize,
                    height: this.itemSize
                };

                this.itemsContainer.appendChild(el);
                this.items.push(item);
            },

            update(dt) {
                // 1. Difficulty Ramp
                this.difficultyTimer += dt;
                if (this.difficultyTimer > 5000) { // Every 5 seconds get harder
                    this.speedMultiplier += 0.05;
                    this.spawnInterval = Math.max(400, this.spawnInterval - 50);
                    this.difficultyTimer = 0;
                }

                // 2. Player Movement
                let moveDir = 0;
                if (this.keys.ArrowLeft || this.touchInput === -1) moveDir = -1;
                if (this.keys.ArrowRight || this.touchInput === 1) moveDir = 1;

                if (moveDir !== 0) {
                    const speed = (this.width < 600 ? this.mobilePlayerSpeed : this.basePlayerSpeed) * (dt / 16);
                    this.playerX += moveDir * speed;

                    // Clamp
                    if (this.playerX < 0) this.playerX = 0;
                    if (this.playerX > this.width - this.playerWidth) this.playerX = this.width - this.playerWidth;

                    this.updatePlayerPos();
                }

                // 3. Spawning
                this.spawnTimer += dt;
                if (this.spawnTimer > this.spawnInterval) {
                    this.spawnItem();
                    this.spawnTimer = 0;
                }

                // 4. Update Items
                for (let i = this.items.length - 1; i >= 0; i--) {
                    const item = this.items[i];
                    item.y += item.speed * (dt / 1000);

                    // Render item
                    item.el.style.transform = `translate(${item.x}px, ${item.y}px)`;

                    // Collision Detection
                    if (this.checkCollision(this.playerX, this.playerWidth, item)) {
                        if (item.isCorrect) {
                            // Score!
                            this.score++;
                            this.updateHUD();
                            this.removeItem(i);
                        } else {
                            // Game Over
                            this.gameOver();
                            return;
                        }
                    } else if (item.y > this.height) {
                        // Missed item
                        this.removeItem(i);
                    }
                }
            },

            checkCollision(px, pw, item) {
                // Simple AABB
                // Player Y is fixed at bottom: 20px from bottom.
                const py = this.height - 20 - this.playerHeight;

                // Hitbox shrinking for better feel
                const padding = 10;

                return (
                    item.x < px + pw - padding &&
                    item.x + item.width > px + padding &&
                    item.y + item.height > py + padding &&
                    item.y < py + this.playerHeight - padding
                );
            },

            removeItem(index) {
                const item = this.items[index];
                if (item.el.parentNode) {
                    item.el.parentNode.removeChild(item.el);
                }
                this.items.splice(index, 1);
            },

            updatePlayerPos() {
                this.player.style.transform = `translateX(${this.playerX}px)`;
            },

            updateHUD() {
                this.scoreEl.textContent = `Puntaje: ${this.score}`;
                this.bestScoreEl.textContent = `RÃ©cord: ${this.bestScore}`;
            },

            gameOver() {
                this.state = 'gameover';

                // Update Best Score
                if (this.score > this.bestScore) {
                    this.bestScore = this.score;
                    localStorage.setItem('christmasCatchBestScore', this.bestScore);
                }

                this.finalScoreEl.textContent = `Puntaje obtenido: ${this.score}`;
                this.finalBestScoreEl.textContent = `RÃ©cord personal: ${this.bestScore}`;

                this.gameOverScreen.classList.remove('hidden');
            },

            loop(timestamp) {
                if (this.state !== 'playing') return;

                const dt = timestamp - this.lastTime;
                this.lastTime = timestamp;

                this.update(dt);

                requestAnimationFrame((t) => this.loop(t));
            }
        };

        // Initialize on load
        window.onload = () => Game.init();

    </script>
</body>

</html>